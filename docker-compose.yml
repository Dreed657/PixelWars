version: '3.7'
services:
    client-user:
        build:
            context: ./client-user
            dockerfile: ./Dockerfile
        ports:
            - '80:80'
        networks:
            - war-network
        depends_on:
            - server-ws

    client-cli:
        build:
            context: ./client-cli
            dockerfile: ./Dockerfile
        restart: on-failure
        environment:
            - 'URL=ws://server-ws:9999'
            - 'REST_ADDRESS=http://server-rest:3000/v1'
        networks:
            - war-network
        depends_on:
            - server-rest
            - server-ws

    server-ws:
        build:
            context: ./server-ws
            dockerfile: ./Dockerfile
        environment:
            - 'SIZE=5'
            - 'REST_ADDRESS=http://server-rest:3000/v1'
        ports:
            - '9999:9999'
        depends_on:
            - server-rest
        networks:
            - war-network

    server-rest:
        build:
            context: ./server-rest
            dockerfile: ./Dockerfile
        restart: on-failure
        environment:
            - 'PORT=3000'
            - 'DATABASE_URL=postgresql://postgres:mysecretpassword@db:5432/pixelwars?schema=pixelwars'
        ports:
            - '3000:3000'
        networks:
            - war-network
        depends_on:
            - db

    db:
        image: postgres
        restart: always
        ports:
            - 8888:5432
        environment:
            POSTGRES_PASSWORD: mysecretpassword
        volumes:
            - ~/dev/volumes/pixelwars:/var/lib/postgresql/data
        networks:
            - war-network

networks:
    war-network:
